{
    "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
    "contentVersion": "1.0.0.0",
    "parameters": {
      "BoomiAuthenticationType": {
        "type": "string",
        "metadata": {
          "description": "Boomi Platform Authentication Type"
        }
      },
      "accountId": {
        "type": "string",
        "metadata": {
          "description": "The Boomi account ID that you want to associate with the new Molecule cluster."
        }
      },
      "user": {
        "type": "string",
        "metadata": {
          "description": "The email account associated with the Boomi account."
        }
      },
      "BoomiMFAAPIToken": {
        "type": "securestring",
        "metadata": {
          "description": "An MFA API token generated by your Dell Boomi Administrator."
        }
      },
      "password": {
        "type": "securestring",
        "metadata": {
          "description": "The password associated with the Boomi account."
        }
      },
      "utcValue": {
        "type": "string",
        "defaultValue": "[utcNow()]"
      },
      "_artifactsLocation": {
      "type" : "string",
      "metadata" : {
        "description": "The base Url for dependent assets",
        "artifactsBaseUrl": ""
      }
    }
    },
    "variables": {
        "nestedtscriptUri1": "[uri(parameters('_artifactsLocation'), concat('scripts/license_validation.sh'))]",
        "nestedtscriptUri2": "[uri(parameters('_artifactsLocation'), concat('scripts/requirements.txt'))]",
        "nestedtscriptUri3": "[uri(parameters('_artifactsLocation'), concat('scripts/license_validation.py'))]"
    },
    "resources": [
      {
        "type": "Microsoft.Resources/deploymentScripts",
        "apiVersion": "2020-10-01",
        "name": "boomiLicenseValidate",
        "location": "[resourceGroup().location]",
        "kind": "AzureCLI",
        "properties": {
          "forceUpdateTag": "[parameters('utcValue')]",
          "AzCliVersion": "2.10.1",
          "timeout": "PT1H",
          "environmentVariables": [
            {
              "name": "RESOURCEGROUP",
              "secureValue": "[resourceGroup().name]"
            },
            {
              "name": "BOOMIAUTHENTICATIONTYPE",
              "value": "[parameters('BoomiAuthenticationType')]"
            },
            {
              "name": "ATOMUSERNAME",
              "value": "[parameters('user')]"
            },
            {
              "name": "ATOMPASSWORD",
              "value": "[parameters('password')]"
            },
            {
              "name": "ATOMACCOUNTID",
              "value": "[parameters('accountId')]"
            },
            {
              "name": "BOOMIMFAAPITOKEN",
              "value": "[parameters('BoomiMFAAPIToken')]"
            },
            {
              "name": "REQTXT",
              "value": "[variables('nestedtscriptUri2')]"
            },
            {
              "name": "LICENSEVALIDATION",
              "value": "[variables('nestedtscriptUri3')]"
            }
          ],
          "primaryScriptUri": "[variables('nestedtscriptUri1')]",
          "cleanupPreference": "Always",
          "retentionInterval": "P1D"
        }
      }
    ],
    "outputs": {
      "licenseValidation": {
        "type": "string",
        "value": "[reference(resourceId('Microsoft.Resources/deploymentScripts', 'boomiLicenseValidate')).outputs.license_validation]"
      },
      "installationToken": {
        "type": "string",
        "value": "[reference(resourceId('Microsoft.Resources/deploymentScripts', 'boomiLicenseValidate')).outputs.installation_token]"
      }
    }
  }
